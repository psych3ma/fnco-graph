# 그래프 조회 시 아무것도 안 뜨는 현상 — CTO 검토 (그래프 DB·백엔드)

## 현상

- 초기 로드 시 그래프 영역이 비어 있음.
- 콘솔: `/api/graph?limit=1000&...` **요청 타임아웃** 후 `[App] 데이터 로드 완료: 노드 0개, 링크 0개`.
- 통계(노드 유형 건수)는 별도 `/api/statistics` 호출로 표시되어, “데이터는 있는데 그래프만 비어 보임”처럼 보일 수 있음.

---

## 원인 (CTO 요약)

1. **그래프 API 타임아웃**  
   - limit=1000, 여러 node_labels(Company, Person, Stockholder 등) 조건으로 Neo4j 쿼리가 30초 안에 끝나지 않음.
   - 프론트 기본 타임아웃 30초에서 **먼저 끊김**.

2. **타임아웃 시 잘못된 폴백**  
   - `api-client.getGraphData()`가 **모든 에러**를 catch한 뒤 `{ nodes: [], edges: [] }`를 반환.
   - 타임아웃(AbortError → TimeoutError)도 여기서 잡혀서 **예외가 app.js까지 전달되지 않음**.
   - 앱은 “정상 응답인데 노드 0개”로 처리 → 빈 그래프만 그리며, “요청 시간 초과” 메시지도 안 뜸.

3. **백엔드**  
   - Neo4j 트랜잭션 타임아웃/쿼리 최적화 없이 limit 1000 + 다중 라벨 OR 조건만으로 조회 → 대량 데이터 시 지연 가능성 있음.

---

## 적용한 수정 (협업·확장성·유지보수)

| 구분 | 내용 |
|------|------|
| **프론트** | `getGraphData`에서 **타임아웃인 경우 재throw**하여 app.js가 “요청 시간 초과” 메시지·로딩 에러 표시하도록 함. |
| **프론트** | 그래프 **전용 타임아웃** `API_CONFIG.GRAPH_REQUEST_TIMEOUT`(60초) 추가, `getGraphData`에만 적용. 상수만 바꾸면 확장 가능. |
| **동작** | 타임아웃 시 이제 “요청 시간 초과” 안내 후 빈 그래프로 진행하지 않음. |

---

## 백엔드/Neo4j 권장 (확장성·유지보수)

- **인덱스**: 관계 타입·노드 라벨(또는 자주 쓰는 속성)에 맞는 인덱스가 있으면 쿼리 시간 단축. Neo4j 쿼리 플랜으로 확인 권장.
- **limit**: 첫 로드는 500 등으로 낮춰 빠르게 첫 화면을 보여주고, “더 보기”로 추가 로드하는 방식 검토.
- **트랜잭션 타임아웃**: Neo4j 드라이버/세션에서 긴 쿼리 허용 시 트랜잭션 타임아웃을 60초 이상으로 설정하는 것 검토.

이 문서는 `docs/`에 두고, 그래프 조회 이슈 시 참고용으로 사용하면 됨.
