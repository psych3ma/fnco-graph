# NetworkX·vis 기반 UX 전문가 검토 (유지보수성·확장성·협업코드)

현재 화면(그래프 뷰·포커스 노드·노드 상세 패널)을 NetworkX·vis.js 베이스 UX 관점에서 정리하고, 유지보수성·확장성·협업코드 관점에서 권장 사항을 정리한다.

---

## 1. 현재 UI 정리 (스크린 기준)

### 1.1 그래프 뷰
- **중심 노드**: 회사(예: 유화증권(주))를 중심으로 스타 형태 연결. 다양한 연결(회사–개인·회사–회사)이 한눈에 보이도록 `suggested_focus_node_id`(다양도 후보) 적용.
- **노드 구분**: 타입별 색상(회사·개인주주·최대주주·기관) — `NODE_TYPE_META` 단일 소스. vis `shape: 'dot'`, border/background로 타입 구분.
- **엣지**: 주로 오렌지 계열, 방향 화살표. 선택/하이라이트 시 강조.
- **좌측**: 유형별 건수(회사 227, 개인주주 4692 등) — 필터·레전드와 동일한 타입 체계.

### 1.2 노드 상세 패널
- **식별**: 회사/개인 등 타입 뱃지 + ID(예: 110111) + 노드명(유화증권(주)).
- **핵심 지표**: 최대주주 지분율, 주주 수 — DB/API 연동. `-` 표시 시 `node.properties` 경로 보강 및 `maxStockRatioFromRels` fallback으로 개선됨.
- **연결 노드**: "연결 노드 (N)" + 처음 소수 개 노드 + "더보기 (M개)". 노드 id 기준 디듀프로 동일 인물 중복 행 제거됨.
- **액션**: "이 노드 기준 지배구조 맵 보기", "이 노드에 대해 AI에게 질문하기" — 전역 참조·탭 표시·실패 토스트로 동작 보강됨.

---

## 2. UX 관점 평가

### 2.1 강점
- **타입 체계 일원화**: 그래프 색상·레전드·패널 뱃지·필터가 모두 `NODE_TYPE_META`·`LABEL_TO_TYPE_MAP` 등 상수에서 나와 시각·용어가 일치함. 확장 시 상수만 추가하면 됨.
- **정보 계층**: 상세 패널이 식별 → 지표 → 연결 → 속성 → 액션 순으로 구성돼 읽기·스캔이 수월함.
- **점진적 노출**: 연결 노드 "더보기"로 목록을 나누어, 연결 수가 많을 때도 첫 로딩 부담을 줄임(확장성).
- **그래프–패널 연동**: 선택 상태를 `selectedNode` 한 곳에서 관리하고, 그래프 클릭·캔버스 클릭·검색·패널 "연결 노드" 클릭이 동일한 state를 통해 반영됨(협업·예측 가능성).

### 2.2 개선·유의 사항
- **밀집 구역 가독성**: 중심 노드 연결이 매우 많을 때 노드·라벨 겹침 가능. vis 옵션(노드 간 거리, 폰트 크기, `avoidOverlap`)과 노드 캡·표시 수 정책을 한 곳에 두면 유지보수에 유리함.
- **"-" 표시 의미**: 최대주주 지분율·주주 수가 `-`일 때 "데이터 없음"인지 "로딩 중"인지 사용자에게 짧게 구분해 주면 혼동을 줄일 수 있음(예: 툴팁 또는 보조 문구).
- **연결 노드 수 라벨**: "연결 노드 (N)"이 디듀프 후 **고유 노드 수**임을 팀·문서에 명시해 두면, 나중에 "관계 수"와 혼동하지 않음(협업).
- **접근성**: 그래프 포커스·노드 선택에 스크린 리더 안내가 들어가 있음. 패널 내 "더보기"·버튼에 키보드 포커스·aria 확장 상태가 일치하는지 주기적으로 확인할 것을 권장.

---

## 3. NetworkX·vis 관점

### 3.1 데이터·분석
- **백엔드**: NetworkX로 degree_centrality, pagerank, 다양도 기반 `suggested_focus_node_id` 제공. 그래프 데이터와 분석이 `/api/graph/analysis` 한 경로로 오므로, 프론트는 "추천 노드·지표"를 같은 응답에서 사용할 수 있음(단일 소스).
- **레이아웃**: vis forceAtlas2Based + 안정화 후 physics 비활성화로, "클릭/호버와 노드 위치 불일치"를 줄임. 리사이즈 시 `redraw()`로 캔버스와 뷰 동기화.

### 3.2 상호작용
- **드래그**: 그래프 컨테이너에서 mousedown/touchstart 시 `preventDefault()`로 문서·상위 스크롤이 개입하지 않아, "마우스 드래그와 그래프 따로 놀음"을 완화.
- **휠**: `.graph-area`에서 `stopPropagation()`으로 상위로 휠이 전달되지 않아, 줌만 그래프에 적용됨.
- **선택 시 멈춤**: 하이라이트·줌을 `requestAnimationFrame`으로 다음 프레임에 실행해, 선택 반영을 먼저 보이도록 함.

---

## 4. 유지보수성·확장성·협업코드

### 4.1 유지보수성
- **상수 중앙화**: 노드 타입·색상·라벨은 `config/constants.js`의 `NODE_TYPE_META`, `NODE_LABELS` 등에서만 정의. 그래프·패널·필터가 이를 참조하므로, 타입 추가·색 변경 시 한 곳만 수정하면 됨.
- **역할 분리**: GraphManager(vis·선택·하이라이트), PanelManager(상세·버튼·탭), StateManager(selectedNode 등)로 나뉘어 있어, 이벤트·상태 흐름을 추적하기 쉬움.
- **문서화**: CTO 문서(선택·패널 연동, 노드 상세 이슈, 드래그 동기화, 첫 화면 다양도 등)에 원인·조치·파일 위치가 정리돼 있어, 동일 이슈 재발 시 대응이 빠름.

### 4.2 확장성
- **노드 타입 추가**: 상수에 타입·색·라벨 추가 후, 그래프 `toVisNode`·패널 `connItem` 등이 `typeMeta`를 쓰므로 대부분 자동 반영. 백엔드 라벨과의 매핑만 맞추면 됨.
- **새 지표**: 분석 API에 필드 추가 시, 프론트는 `initialAnalysis`에서 해당 키만 읽어 사용하면 됨. suggested_focus 정책 변경도 백엔드에서만 처리 가능.
- **연결 노드 수**: 현재 N은 "고유 노드 수". 관계 수를 따로 보여주고 싶다면 API에서 `relationship_count` 등을 내려주고 패널에 별도 표기하면 됨.

### 4.3 협업코드
- **계약 명시**: "선택의 진실은 state(selectedNode)뿐", "그래프 영역 드래그 = 팬 전용", "첫 화면 추천 = analysis.suggested_focus_node_id 우선" 등이 문서·주석에 있음.
- **전역 노출**: `window.app`, `window.graphManager`, `window.panelManager`는 디버깅·HTML 인라인 핸들러용. 새 기능은 state·매니저 메서드 경유로 두면 테스트·추론이 쉬움.
- **에러 피드백**: API 실패 시 토스트(맵 보기 등), 선택 없을 때 스크린 리더 안내 등으로 "동작 안 함"만 보이는 상황을 줄임.

---

## 5. 권장 체크리스트 (진행·추가 시)

| 구분 | 항목 | 상태 |
|------|------|------|
| 데이터 | 노드 상세 DB 값(지분율·주주 수) 표시 | 반영됨(nodeProps.properties 등) |
| 데이터 | 연결 노드 중복 제거(노드 id 기준) | 반영됨(dedupeConnectedNodes) |
| 상호작용 | 드래그 시 그래프만 팬(문서 스크롤 분리) | 반영됨(mousedown/touchstart preventDefault) |
| 상호작용 | 노드 선택 시 멈춤 완화 | 반영됨(highlight·줌을 rAF로 분리) |
| 상호작용 | 탭 전환(예: AI 질문) 시 채팅 영역 표시 | 반영됨(display 명시) |
| 첫 화면 | 다양한 연결(회사·개인 혼합) 추천 노드 | 반영됨(suggested_focus_node_id) |
| UX | "-" 표시 시 "데이터 없음" 등 보조 설명 | 선택 적용 |
| UX | 연결 노드 수 = 고유 노드 수 정책 문서화 | 팀 공유 권장 |
| 확장 | 밀집 구역 노드/라벨 겹침 정책(상수·옵션) | 필요 시 vis 옵션·문서 정리 |

---

## 6. 요약

- **NetworkX·vis 기반**으로 그래프 데이터·분석(suggested_focus, centrality)이 API 한 경로에서 오고, vis는 레이아웃·상호작용만 담당하는 구조가 잘 잡혀 있음.
- **UX** 측면에서는 타입별 색상·패널 계층·점진적 노출(더보기)이 일관되고, 이미 반영된 수정(DB 값, 디듀프, 드래그 동기화, 선택 멈춤, 탭 표시, 다양도 추천)으로 "따로 노는" 느낌과 데이터/버튼 이슈가 상당 부분 해소된 상태임.
- **유지보수·확장·협업**을 위해 상수 단일 소스, state 계약, CTO 문서를 유지하고, "-" 의미·연결 노드 수 정의·밀집 구역 정책만 보완하면 이후 확장 시에도 예측 가능하게 유지할 수 있음.
