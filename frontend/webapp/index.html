<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NodeScope — 지배구조 탐색</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">

<link rel="stylesheet" href="css/styles.css">
</head>
<body>

<!-- ═══════════════════════════════════
     HEADER
═══════════════════════════════════ -->
<header>
  <div class="logo">
    <div class="logo-icon" aria-hidden="true">N</div>
    <span>NodeScope</span>
  </div>

  <div class="search-wrap">
    <span class="search-icon" aria-hidden="true">🔍</span>
    <input 
      type="text" 
      id="searchInput" 
      placeholder="회사명, 주주명 검색…"
      aria-label="노드 검색"
      autocomplete="off">
    <div class="suggestions" id="suggestions" role="listbox" aria-label="검색 제안"></div>
  </div>

  <div class="filters" id="filters" role="group" aria-label="노드 타입 필터">
    <button class="chip company active" 
            data-type="company"
            role="checkbox"
            aria-checked="true"
            aria-label="회사 노드 필터">
      <span class="dot company" aria-hidden="true"></span>회사
    </button>
    <button class="chip person active" 
            data-type="person"
            role="checkbox"
            aria-checked="true"
            aria-label="개인주주 노드 필터">
      <span class="dot person" aria-hidden="true"></span>개인주주
    </button>
    <button class="chip major active" 
            data-type="major"
            role="checkbox"
            aria-checked="true"
            aria-label="최대주주 노드 필터">
      <span class="dot major" aria-hidden="true"></span>최대주주
    </button>
    <button class="chip institution active" 
            data-type="institution"
            role="checkbox"
            aria-checked="true"
            aria-label="기관 노드 필터">
      <span class="dot institution" aria-hidden="true"></span>기관
    </button>
  </div>
</header>

<!-- ═══════════════════════════════════
     WORKSPACE
═══════════════════════════════════ -->
<div class="workspace">

  <!-- ── GRAPH CANVAS ── -->
  <div class="graph-area" id="graphArea" role="main" aria-label="그래프 시각화 영역">

    <div class="loading-overlay" id="loadingOverlay" aria-live="polite" aria-busy="true">
      <div class="loading-spinner" aria-hidden="true"></div>
      <div class="loading-text" id="loadingText">그래프 데이터 불러오는 중…</div>
      <div class="loading-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
        <div class="loading-bar" id="loadingBar"></div>
      </div>
    </div>

    <div id="visNetwork" aria-label="그래프 네트워크"></div>
    <div id="graphTooltip" role="tooltip" aria-hidden="true"></div>

    <div class="graph-stats" id="graphStats" aria-label="그래프 통계"></div>

    <div class="zoom-controls" role="group" aria-label="줌 컨트롤">
      <button class="zoom-btn" 
              id="zoomIn" 
              title="확대"
              aria-label="그래프 확대">
        <svg width="14" height="14" viewBox="0 0 16 16" fill="none" aria-hidden="true">
          <path d="M8 3v10M3 8h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <button class="zoom-btn" 
              id="zoomOut" 
              title="축소"
              aria-label="그래프 축소">
        <svg width="14" height="14" viewBox="0 0 16 16" fill="none" aria-hidden="true">
          <path d="M3 8h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <button class="zoom-btn" 
              id="zoomFit" 
              title="전체보기"
              aria-label="그래프 전체 보기">
        <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" aria-hidden="true">
          <path d="M2 5V3h2M12 3h2v2M14 11v2h-2M4 13H2v-2"/>
        </svg>
      </button>
    </div>

    <div class="graph-legend" id="legend" role="group" aria-label="노드 타입 범례">
      <div class="legend-title">노드 유형</div>
      <div class="legend-row" data-type="company" role="button" tabindex="0" aria-label="회사 노드 타입 토글">
        <div class="lc" aria-hidden="true"></div>
        <span class="legend-label">회사</span>
        <span class="legend-count" id="cnt-company">0 건</span>
      </div>
      <div class="legend-row" data-type="person" role="button" tabindex="0" aria-label="개인주주 노드 타입 토글">
        <div class="lc" aria-hidden="true"></div>
        <span class="legend-label">개인주주</span>
        <span class="legend-count" id="cnt-person">0 건</span>
      </div>
      <div class="legend-row" data-type="major" role="button" tabindex="0" aria-label="최대주주 노드 타입 토글">
        <div class="lc" aria-hidden="true"></div>
        <span class="legend-label">최대주주</span>
        <span class="legend-count" id="cnt-major">0 건</span>
      </div>
      <div class="legend-row" data-type="institution" role="button" tabindex="0" aria-label="기관 노드 타입 토글">
        <div class="lc" aria-hidden="true"></div>
        <span class="legend-label">기관</span>
        <span class="legend-count" id="cnt-institution">0 건</span>
      </div>
    </div>

  </div><!-- /graph-area -->

  <!-- ══════════════════════════════════
       SIDE PANEL
  ══════════════════════════════════ -->
  <div class="side-panel" id="sidePanel" role="complementary" aria-label="상세 정보 패널">

    <!-- ── TABS ── -->
    <div class="panel-tabs" role="tablist" aria-label="패널 탭">
      <button class="ptab active" 
              data-tab="detail" 
              role="tab"
              aria-selected="true"
              aria-controls="detailTabBody"
              onclick="window.app?.switchPanelTab('detail')">노드 상세</button>
      <button class="ptab" 
              data-tab="chat" 
              role="tab"
              aria-selected="false"
              aria-controls="chatTabBody"
              onclick="window.app?.switchPanelTab('chat')">AI 질문</button>
    </div>

    <!-- ego banner -->
    <div class="ego-banner" id="egoBanner" role="alert" aria-live="polite">
      <span class="ego-banner-label">지배구조 맵 (Ego-Graph)</span>
      <button class="ego-exit-btn" 
              onclick="window.panelManager?.exitEgoGraph()"
              aria-label="전체 그래프로 돌아가기">전체 그래프로 돌아가기</button>
    </div>

    <!-- ── DETAIL TAB ── -->
    <div class="panel-body" 
         id="detailTabBody" 
         role="tabpanel"
         aria-labelledby="detail-tab">

      <!-- empty state -->
      <div class="panel-empty" id="panelEmpty">
        <svg width="44" height="44" viewBox="0 0 48 48" fill="none" aria-hidden="true">
          <circle cx="14" cy="14" r="6" stroke="#c9bdb2" stroke-width="1.8"/>
          <circle cx="34" cy="14" r="6" stroke="#c9bdb2" stroke-width="1.8"/>
          <circle cx="14" cy="34" r="6" stroke="#c9bdb2" stroke-width="1.8"/>
          <circle cx="34" cy="34" r="6" stroke="#c9bdb2" stroke-width="1.8"/>
          <circle cx="24" cy="24" r="7" stroke="#c9bdb2" stroke-width="1.8"/>
          <line x1="19" y1="19" x2="14" y2="14" stroke="#c9bdb2" stroke-width="1.4"/>
          <line x1="29" y1="19" x2="34" y2="14" stroke="#c9bdb2" stroke-width="1.4"/>
          <line x1="19" y1="29" x2="14" y2="34" stroke="#c9bdb2" stroke-width="1.4"/>
          <line x1="29" y1="29" x2="34" y2="34" stroke="#c9bdb2" stroke-width="1.4"/>
        </svg>
        <p>그래프에서 노드를 클릭하면<br>상세 정보를 확인할 수 있습니다</p>
        <span>노드를 드래그하여 그래프를 탐색하세요</span>
      </div>

      <!-- node detail (동적으로 렌더링됨) -->
      <div class="node-detail" id="nodeDetail"></div>

    </div><!-- /detailTabBody -->

    <!-- ── CHAT TAB ── -->
    <div class="chat-section" 
         id="chatTabBody" 
         role="tabpanel"
         aria-labelledby="chat-tab">

      <div class="ctx-bar hidden" id="ctxBar" role="status" aria-live="polite">
        <svg width="10" height="10" viewBox="0 0 11 11" fill="none" aria-hidden="true">
          <circle cx="5.5" cy="5.5" r="4.5" stroke="#d85604" stroke-width="1"/>
          <path d="M5.5 3v3l2 1.5" stroke="#d85604" stroke-width="1" stroke-linecap="round"/>
        </svg>
        <span class="ctx-label">컨텍스트:</span>
        <span class="ctx-chip" id="ctxChip"></span>
        <button class="ctx-clear" 
                onclick="window.panelManager?.clearChatContext()"
                aria-label="컨텍스트 제거">✕</button>
      </div>

      <div class="chat-msgs" id="chatMsgs" role="log" aria-live="polite" aria-label="채팅 메시지">
        <div id="sugState">
          <div class="sug-header">노드를 선택하거나 아래 질문을 눌러보세요</div>
          <div class="suggestions-list" role="group" aria-label="제안 질문">
            <button class="sug-btn" 
                    onclick="window.chatManager?.sendSuggestion(this)" 
                    data-q="지분율 50% 이상인 최대주주 목록을 보여줘"
                    aria-label="지분율 50% 이상 최대주주 목록 질문">지분율 50% 이상 최대주주 목록</button>
            <button class="sug-btn" 
                    onclick="window.chatManager?.sendSuggestion(this)" 
                    data-q="국민연금이 5% 이상 보유한 회사는 어디야?"
                    aria-label="국민연금 5% 이상 보유 회사 질문">국민연금 5% 이상 보유 회사</button>
            <button class="sug-btn" 
                    onclick="window.chatManager?.sendSuggestion(this)" 
                    data-q="2022년 등기임원 평균보수가 가장 높은 회사 TOP 5"
                    aria-label="임원보수 TOP 5 질문">임원보수 TOP 5 (2022년)</button>
            <button class="sug-btn" 
                    onclick="window.chatManager?.sendSuggestion(this)" 
                    data-q="3개 이상 법인에 투자한 주주를 찾아줘"
                    aria-label="다중 법인 투자 주주 질문">다중 법인 투자 주주</button>
          </div>
        </div>
      </div>

      <div class="chat-input-area">
        <div class="chat-input-wrap">
          <textarea
            class="chat-textarea" 
            id="chatInput" 
            rows="1"
            placeholder="이 노드에 대해 질문하세요..."
            aria-label="채팅 입력"
            onkeydown="window.chatManager?.handleChatKey(event)"
            oninput="window.chatManager?.autoResizeTextarea(this)"></textarea>
          <button class="chat-send" 
                  onclick="window.chatManager?.sendChat()"
                  aria-label="메시지 전송">
            <svg width="13" height="13" viewBox="0 0 13 13" fill="none" aria-hidden="true">
              <path d="M11 6.5L2 2l2 4.5-2 4.5 9-4.5z" fill="white"/>
            </svg>
          </button>
        </div>
        <div class="chat-footer">
          <button class="chat-reset-btn" 
                  onclick="window.chatManager?.resetChat()"
                  aria-label="대화 초기화">
            <svg width="11" height="11" viewBox="0 0 12 12" fill="none" aria-hidden="true">
              <path d="M6 2v3l2-2M6 5l-2-2M2 6a4 4 0 1 1 8 0" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            대화 초기화
          </button>
        </div>
      </div>

    </div><!-- /chatTabBody -->

  </div><!-- /side-panel -->

</div><!-- /workspace -->

<!-- 스크린 리더 전용 영역 -->
<div id="aria-live-region" class="sr-only" aria-live="polite" aria-atomic="true"></div>

<!-- ═══════════════════════════════════
     JAVASCRIPT MODULES
═══════════════════════════════════ -->
<script type="module" src="js/app.js"></script>

</body>
</html>
